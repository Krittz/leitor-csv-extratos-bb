<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Extrato Banco do Brasil</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
    <div
        class="w-full max-w-6xl bg-white rounded-2xl shadow-lg p-8 print:bg-white print:shadow-none print:rounded-none">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 print:hidden">Extrato - Banco do Brasil</h1>

        <div class="flex items-center justify-between gap-4 mb-6 print:hidden">
            <input type="file" id="csvFile" accept=".csv" class="block text-sm text-gray-700 file:mr-4 file:py-2 file:px-4
               file:rounded-full file:border-0
               file:text-sm file:font-semibold
               file:bg-blue-50 file:text-blue-700
               hover:file:bg-blue-100" />

            <button onclick="window.print()" class="inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-md shadow
               hover:bg-green-700 transition">
                üñ®Ô∏è Imprimir Extrato
            </button>
        </div>

        <div id="tableContainer" class="overflow-auto max-h-[70vh] text-sm print:overflow-visible print:max-h-none">
        </div>
    </div>

    <script>
        document.getElementById('csvFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (event) {
                const bytes = new Uint8Array(event.target.result);
                const decoder = new TextDecoder('windows-1252');
                const text = decoder.decode(bytes);

                const lines = text.trim().split('\n');
                const rows = lines.map(line =>
                    line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)?.map(cell =>
                        cell.replace(/^"|"$/g, '')
                    ) ?? []
                );

                if (rows.length === 0) {
                    document.getElementById('tableContainer').innerHTML = '<p class="text-red-500">Erro ao processar o arquivo.</p>';
                    return;
                }

                let html = '<table class="min-w-full border border-gray-300 text-left print:text-xs">';
                html += '<thead class="bg-gray-50 sticky top-0 shadow-sm print:shadow-none print:bg-white">';
                html += '<tr>';
                rows[0].forEach(cell => {
                    html += `<th class="px-4 py-2 font-medium text-gray-700 border-b">${cell}</th>`;
                });
                html += '</tr></thead><tbody>';

                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    html += '<tr class="hover:bg-gray-50 print:hover:bg-white">';
                    row.forEach(cell => {
                        const isNegative = /^-/.test(cell);
                        const isCurrency = /^[\d.,-]+$/.test(cell);
                        const cellClass = isCurrency
                            ? (isNegative ? 'text-red-600 font-semibold' : 'text-green-700 font-semibold')
                            : 'text-gray-700';

                        html += `<td class="px-4 py-2 border-b whitespace-nowrap ${cellClass}">${cell || '-'}</td>`;
                    });
                    html += '</tr>';
                }

                html += '</tbody></table>';
                document.getElementById('tableContainer').innerHTML = html;
            };

            reader.readAsArrayBuffer(file);
        });
    </script>
</body>

</html>